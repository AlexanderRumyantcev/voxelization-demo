# Voxelization Demo

Интерактивная демонстрация алгоритма вокселизации 3D-моделей, написанная на C с использованием библиотеки [raylib](https://www.raylib.com/).

---

## Что такое вокселизация

**Воксель** (voxel, от *volumetric pixel*) — минимальная единица трёхмерного пространства, аналог пикселя для 3D. Вокселизация — это процесс преобразования непрерывной 3D-геометрии (облако точек, полигональная сетка) в дискретную сетку кубических ячеек.

### Как работает алгоритм

1. **Парсинг PLY-файла.** Программа читает координаты вершин (X, Y, Z) из текстового PLY-файла и находит минимальные и максимальные значения по каждой оси.

2. **Нормализация.** Все координаты масштабируются в диапазон `[0, 5]`, чтобы модель помещалась в сцену независимо от исходных единиц измерения.

3. **Построение охватывающего параллелепипеда.** Вокруг модели строится минимальный ограничивающий прямоугольный параллелепипед по рассчитанным min/max координатам.

4. **Разбивка на воксели.** Параллелепипед делится на равные кубические ячейки. Размер ребра вокселя вычисляется из заданного количества вокселей:
   ```
   voxel_size = cbrt(volume / voxel_count)
   ```
   Сетка заполняется последовательно по осям X → Y → Z.

5. **Распределение вершин.** Каждая вершина модели относится к конкретному вокселю по формуле индексирования в одномерном массиве:
   ```
   ind = zi * (nx * ny) + yi * nx + xi
   ```
   где `xi`, `yi`, `zi` — позиция вокселя по каждой оси, `nx`, `ny` — количество вокселей вдоль осей X и Y.

6. **Визуализация.** Ячейки сетки отрисовываются как каркасные кубы. При включении режима вокселизации подсвечиваются только те ячейки, которые содержат хотя бы две вершины модели — это и есть результат вокселизации.

---

## Зависимости

- **gcc** (или совместимый C99-компилятор)
- **raylib** ≥ 4.0 — графическая библиотека ([инструкция по установке](https://github.com/raysan5/raylib#installation))
- **raygui** — заголовочный файл UI (входит в состав raylib)
- **make**

---

## Установка raylib

**macOS (Homebrew):**
```bash
brew install raylib
```

**Ubuntu / Debian:**
```bash
sudo apt install libraylib-dev
```

**Windows:**
Скачайте prebuilt-сборку с [raylib releases](https://github.com/raysan5/raylib/releases) и распакуйте в `C:/raylib`.

---

## Сборка

```bash
make
```

Для сборки на Windows с нестандартным путём к raylib:
```bash
make RAYLIB_PATH=C:/raylib
```

Очистить артефакты сборки:
```bash
make clean
```

---

## Использование

1. Поместите PLY-файл 3D-модели в папку `models/` под именем `bun_zipper.ply`
   *(тестовая модель Stanford Bunny: http://graphics.stanford.edu/data/3Dscanrep/)*

2. Запустите приложение:
```bash
./myapp        # macOS / Linux
myapp.exe      # Windows
```

### Управление

| Действие | Управление |
|---|---|
| Вращение камеры | Правая кнопка мыши (удерживать) |
| Показать/скрыть вершины модели | Кнопка **Draw Verts** |
| Включить/выключить подсветку заполненных вокселей | Кнопка **voxelization** |
| Изменить разрешение сетки | Выпадающий список (125 / 15 625 / 125 000) |

---

## Разрешения сетки

| Название | Вокселей | Сетка |
|---|---|---|
| low | 125 | 5 × 5 × 5 |
| middle | 15 625 | 25 × 25 × 25 |
| high | 125 000 | 50 × 50 × 50 |

---

## Структура проекта

```
voxelization-demo/
├── main.c       # Основной исходный код
├── voxel.h      # Структуры данных, макросы, прототипы функций
├── Makefile     # Сборка для Windows / macOS / Linux
├── models/      # Папка для PLY-файла модели
└── README.md
```
